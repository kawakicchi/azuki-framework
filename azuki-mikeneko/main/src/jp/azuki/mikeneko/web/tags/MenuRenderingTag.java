package jp.azuki.mikeneko.web.tags;import java.io.IOException;import java.util.List;import javax.servlet.jsp.JspException;import javax.servlet.jsp.tagext.Tag;import jp.azuki.core.util.StringUtility;import jp.azuki.mikeneko.logic.MenuManager;import jp.azuki.mikeneko.logic.MenuManagerImpl;import jp.azuki.mikeneko.menu.Menu;import jp.azuki.mikeneko.menu.MenuBar;import jp.azuki.mikeneko.menu.MenuItem;import jp.azuki.web.tags.AbstractTag;public class MenuRenderingTag extends AbstractTag {	public MenuRenderingTag() {		super(MenuRenderingTag.class);	}	@Override	public int doStartTag() throws JspException {		return (Tag.SKIP_BODY);	}	@Override	public int doEndTag() throws JspException {		StringBuffer s = new StringBuffer();		doRendering(s);		try {			getPageContext().getOut().print(s.toString());		} catch (IOException ex) {			throw new JspException(ex);		}		return (Tag.EVAL_PAGE);	}	private void doRendering(final StringBuffer s) {		MenuManager mm = new MenuManagerImpl();		MenuBar bar = mm.generate(null); // XXX アカウント情報設定		s.append("<button type=\"button\" class=\"btn btn-navbar\" data-toggle=\"collapse\" data-target=\".nav-collapse\">");		s.append("<span class=\"icon-bar\"></span>");		s.append("<span class=\"icon-bar\"></span>");		s.append("<span class=\"icon-bar\"></span>");		s.append("</button>");		if (StringUtility.isNotEmpty(bar.getTitle())) {			s.append("<a class=\"brand\" href=\"#\">").append(bar.getTitle()).append("</a>");		}		s.append("<div class=\"nav-collapse collapse\">");		s.append("<ul class=\"nav\">");		List<Menu> menus = bar.getMenuList();		for (Menu menu : menus) {			if (!menu.hasItem()) {				// s.append("<li class=\"active\"><a href=\"#\">ホーム</a></li>");				// // アクティブ				s.append("<li><a href=\"").append(menu.getUrl()).append("\">").append(menu.getLabel()).append("</a></li>");			} else {				s.append("<li class=\"dropdown\">");				s.append("<a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">").append(menu.getLabel())						.append(" <b class=\"caret\"></b></a>");				s.append("<ul class=\"dropdown-menu\">");				List<MenuItem> items = menu.getMenuItemList();				for (MenuItem item : items) {					s.append("<li><a href=\"").append(item.getUrl()).append("\">").append(item.getLabel()).append("</a></li>");					// s.append("<li class=\"divider\"></li>"); // セパレータ					// s.append("<li class=\"nav-header\">Nav header</li>");					// 非リンク				}				s.append("</ul>");				s.append("</li>");			}		}		s.append("</ul>");		s.append("</div>");	}}